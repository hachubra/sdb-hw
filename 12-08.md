# Домашнее задание к занятию «Резервное копирование баз данных»

**Домашнее задание выполните в Google Docs или в md-файле в вашем репозитории GitHub.** 

Для оформления вашего решения в GitHub можете воспользоваться [шаблоном](https://github.com/netology-code/sys-pattern-homework).

Название файла должно содержать номер лекции и фамилию студента. Пример названия: «12.8. Резервное копирование баз данных — Александр Александров».

Перед тем как выслать ссылку, убедитесь, что её содержимое не является приватным, то есть открыто на просмотр всем, у кого есть ссылка. Если необходимо прикрепить дополнительные ссылки, просто добавьте их в свой Google Docs.

Любые вопросы по решению задач задавайте в чате учебной группы.

---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

#### Решение 1

1.1. Для возможности восстановления данных в полном объеме за предыдущий день подходит вариант резервного копирования при котором полная резервная копия делается каждый день. С целью оптимизации занимаемого резервными копиями дисковго пространства и ускорения выполнения задачи резервного копирования может использоаваться схема, при которой полное резервное копирование выполняется один раз в неделю, а инкрементальные бэкапы выполняются каждый день. Также, вместо инкрементальных бэкапов, для ускорения скорости восстановления данных, можно использовать дифференцированное резервное копирование, которое будет выполняться каждый день, совместно еженедельным выполнением полного резрвного копирования. 

1.2. Для возможности восстановления данных каждый час лучше подойдет схема резервного коппирования при которой полная копия данных будет делать раз в неделю, дифференцированный бэкап - раз в день, инкрементальный бэкап - каждый час.

1.3. Да, такой вариант возможен. Для защиты данных от аппаратного сбоя можно использовать репликацию данных на другой сервер (как средствами самой СУБД, так и синхронной репликацией на уровне системы хранения данных), тогда все данные будут доступны после переключения на реплику (можно настроить автоматическое переключение по сигналу от системы мониторинга). Для защиты от повреждения самих данных в дополнение к репликации необходимо настроить резервное копирование с приемлемым RPO и RTO. 

---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.2.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

#### Решение 2.

2.1. Создание резервное копии путем дампа БД:
```
pg_dump -Fc имя_базы > имя_файла
```
Восстановление резервной копии из дампа БД:
```
pg_restore -d имя_базы имя_файла
```
2.2. Да, процесс создания и восстановления дампа БД возможно автоматизирвоать с помощью скрипта, который будет запускаться по расписанию.

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

3.2.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

#### Решение 3.

3.1. Пример выполнение инкрементального резервного копирования MySQL:
```
mysqlbackup --defaults-file=/home/dbadmin/my.cnf \
  --incremental --incremental-base=history:last_backup \
  --backup-dir=/home/dbadmin/temp_dir \
  --backup-image=incremental_image1.bi \
   backup-to-image
```

3.2. Использование реплики дает преимущество перед обычным резервным копированием в случае аппаратного сбоя на основном сервере, когда чтобы восстановить работу сервиса неоьбходимо лишь переключиться с мастера на реплику (в случае с синхронной репликацие еще и без потери данных), в то время как при резервном копировании пришлось бы запускать процедуру восстановления данных, которая занимает время и имеет свое RPO. 

---

Задания, помеченные звёздочкой, — дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.
