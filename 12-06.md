# Домашнее задание к занятию «Репликация и масштабирование. Часть 1»

### Инструкция по выполнению домашнего задания

1. Сделайте fork [репозитория c шаблоном решения](https://github.com/netology-code/sys-pattern-homework) к себе в Github и переименуйте его по названию или номеру занятия, например, https://github.com/имя-вашего-репозитория/gitlab-hw или https://github.com/имя-вашего-репозитория/8-03-hw).
2. Выполните клонирование этого репозитория к себе на ПК с помощью команды `git clone`.
3. Выполните домашнее задание и заполните у себя локально этот файл README.md:
   - впишите вверху название занятия и ваши фамилию и имя;
   - в каждом задании добавьте решение в требуемом виде: текст/код/скриншоты/ссылка;
   - для корректного добавления скриншотов воспользуйтесь инструкцией [«Как вставить скриншот в шаблон с решением»](https://github.com/netology-code/sys-pattern-homework/blob/main/screen-instruction.md);
   - при оформлении используйте возможности языка разметки md. Коротко об этом можно посмотреть в [инструкции по MarkDown](https://github.com/netology-code/sys-pattern-homework/blob/main/md-instruction.md).
4. После завершения работы над домашним заданием сделайте коммит (`git commit -m "comment"`) и отправьте его на Github (`git push origin`).
5. Для проверки домашнего задания преподавателем в личном кабинете прикрепите и отправьте ссылку на решение в виде md-файла в вашем Github.
6. Любые вопросы задавайте в чате учебной группы и/или в разделе «Вопросы по заданию» в личном кабинете.

Желаем успехов в выполнении домашнего задания.

---

### Задание 1

На лекции рассматривались режимы репликации master-slave, master-master, опишите их различия.

*Ответить в свободной форме.*

---

#### Решение 1

Базовые различия между master-master и master-slave репликацией заключатеся в том, что в первом случае все изменения, производимые на любой из реплики синхронизируются на все остальные реплики, участвующие в репликации, в случае же master-slave репликации - производится односторонняя репликация данных с master на slave (на все slave). В общем случае, при мастер-мастер репликации все узлы кластера выполняют роли как мастера, так и slave.


---

### Задание 2

Выполните конфигурацию master-slave репликации, примером можно пользоваться из лекции.

*Приложите скриншоты конфигурации, выполнения работы: состояния и режимы работы серверов.*

---

#### Решение 2

###### doker-compose.yml:

```yml
version: '3.7'

services:
  mysql-master:
    container_name: mysql-master
    image: mysql:8.4.2
    restart: always
    command:
      - --mysql-native-password=ON
    ports:
      - "3308:3306"
    environment:
      MYSQL_ROOT_PASSWORD: secret
    volumes:
      - ./mysql_master.cnf:/etc/my.cnf
      - ./mysql_master.sql:/docker-entrypoint-initdb.d/start.sql      

  mysql-slave:
    container_name: mysql-slave
    image: mysql:8.4.2
    restart: always
    command:
      - --mysql-native-password=ON
    ports:
      - "3307:3306"
    environment:
      MYSQL_ROOT_PASSWORD: secret
    volumes:
      - ./mysql_slave.cnf:/etc/my.cnf
      - ./mysql_slave.sql:/docker-entrypoint-initdb.d/start.sql
    depends_on:
      - mysql-master      

```
###### mysql_master.cnf:

```bash
[mysqld]
server-id=1
binlog_format=ROW
log-bin
```

###### mysql_master.sql:

```sql
CREATE USER repl@'%' IDENTIFIED WITH mysql_native_password BY 'slavepass';
GRANT REPLICATION SLAVE ON *.* TO repl@'%';
```

###### mysql_slave.cnf:

```bash
[mysqld]
server-id=2
read_only = 1
```

###### mysql_slave.sql:

```sql
CHANGE MASTER TO 
MASTER_HOST='mysql-master',
MASTER_USER='repl',
MASTER_PASSWORD='slavepass';
```

###### Запуск контейнеров:

```bash 
docker compose up
```

##### Настройка репликации.
###### Master:

```sql
GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%';

SHOW GRANTS FOR repl@'%';

SHOW BINARY LOG STATUS
```

```sql
File                   |Position|Binlog_Do_DB|Binlog_Ignore_DB|Executed_Gtid_Set|
-----------------------+--------+------------+----------------+-----------------+
030d5e50f15a-bin.000003|    1842|            |                |                 |
```

Slave:

```sql
STOP REPLICA

CHANGE REPLICATION SOURCE TO SOURCE_HOST='mysql-master', SOURCE_USER='repl', SOURCE_PASSWORD='slavepass', SOURCE_LOG_FILE='030d5e50f15a-bin.000003', SOURCE_LOG_POS=1842; 

START REPLICA;
```

##### Проверка репликации
```sql
SHOW REPLICA STATUS
```


```sql
Replica_IO_State                |Source_Host |Source_User|Source_Port|Connect_Retry|Source_Log_File        |Read_Source_Log_Pos|Relay_Log_File               |Relay_Log_Pos|Relay_Source_Log_File  |Replica_IO_Running|Replica_SQL_Running|Replicate_Do_DB|Replicate_Ignore_DB|Replicate_Do_Table|Replicate_Ignore_Table|Replicate_Wild_Do_Table|Replicate_Wild_Ignore_Table|Last_Errno|Last_Error|Skip_Counter|Exec_Source_Log_Pos|Relay_Log_Space|Until_Condition|Until_Log_File|Until_Log_Pos|Source_SSL_Allowed|Source_SSL_CA_File|Source_SSL_CA_Path|Source_SSL_Cert|Source_SSL_Cipher|Source_SSL_Key|Seconds_Behind_Source|Source_SSL_Verify_Server_Cert|Last_IO_Errno|Last_IO_Error|Last_SQL_Errno|Last_SQL_Error|Replicate_Ignore_Server_Ids|Source_Server_Id|Source_UUID                         |Source_Info_File       |SQL_Delay|SQL_Remaining_Delay|Replica_SQL_Running_State                               |Source_Retry_Count|Source_Bind|Last_IO_Error_Timestamp|Last_SQL_Error_Timestamp|Source_SSL_Crl|Source_SSL_Crlpath|Retrieved_Gtid_Set|Executed_Gtid_Set|Auto_Position|Replicate_Rewrite_DB|Channel_Name|Source_TLS_Version|Source_public_key_path|Get_Source_public_key|Network_Namespace|
--------------------------------+------------+-----------+-----------+-------------+-----------------------+-------------------+-----------------------------+-------------+-----------------------+------------------+-------------------+---------------+-------------------+------------------+----------------------+-----------------------+---------------------------+----------+----------+------------+-------------------+---------------+---------------+--------------+-------------+------------------+------------------+------------------+---------------+-----------------+--------------+---------------------+-----------------------------+-------------+-------------+--------------+--------------+---------------------------+----------------+------------------------------------+-----------------------+---------+-------------------+--------------------------------------------------------+------------------+-----------+-----------------------+------------------------+--------------+------------------+------------------+-----------------+-------------+--------------------+------------+------------------+----------------------+---------------------+-----------------+
Waiting for source to send event|mysql-master|repl       |       3306|           60|030d5e50f15a-bin.000003|               1842|687558216a66-relay-bin.000002|          335|030d5e50f15a-bin.000003|Yes               |Yes                |               |                   |                  |                      |                       |                           |         0|          |           0|               1842|            553|None           |              |            0|No                |                  |                  |               |                 |              |                    0|No                           |            0|             |             0|              |                           |               1|865cfcf1-87bf-11ef-9d51-0242ac160002|mysql.slave_master_info|        0|                   |Replica has read all relay log; waiting for more updates|                10|           |                       |                        |              |                  |                  |                 |            0|                    |            |                  |                      |                    0|                 |
```

###### master:

```sql
CREATE DATABASE Netology1206;
USE Netology1206;
create table HomeWork (home int, work int);

```
###### slave:

```sql
USE Netology1206;

SHOW tables;
```

```sql
Tables_in_Netology1206|
----------------------+
HomeWork              |
```
---


## Дополнительные задания (со звёздочкой*)
Эти задания дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.

---

### Задание 3* 

Выполните конфигурацию master-master репликации. Произведите проверку.

*Приложите скриншоты конфигурации, выполнения работы: состояния и режимы работы серверов.*

#### Решение 3


